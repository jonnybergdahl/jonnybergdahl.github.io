<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>JBWOPR: JBWopr</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">JBWOPR
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('index.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">JBWopr </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="md__r_e_a_d_m_e"></a> <a href="https://www.ardu-badge.com/JBWopr"><img src="https://www.ardu-badge.com/badge/JBWopr.svg?" alt="arduino-library-badge" style="pointer-events: none;" class="inline"/></a> <img src="https://img.shields.io/badge/license-MIT-blue.svg" alt="GitHub license" style="pointer-events: none;" class="inline"/></p>
<p>JBWopr is a helper library for the Arduino platform that allows you to easily interface with the Unexpected Maker W.O.P.R. board.</p>
<h1><a class="anchor" id="autotoc_md1"></a>
Installation</h1>
<p>Install using the library manager in the Arduino IDE.</p>
<p>This library is compatible with the ESP32 Arduino core version 2.x and 3.x.</p>
<h1><a class="anchor" id="autotoc_md2"></a>
Usage</h1>
<p>The library exposes several classes that you can use to interact with the board.</p>
<ul>
<li><code><a class="el" href="class_j_b_wopr_device.html" title="W.O.P.R. device base class.">JBWoprDevice</a></code> - This is the simplest class that you can use to interact with the board.</li>
<li><code>JBWoprWifiDevice</code> - This adds WiFiManager and web configuration portal support to the <code><a class="el" href="class_j_b_wopr_device.html" title="W.O.P.R. device base class.">JBWoprDevice</a></code> class.</li>
<li><code><a class="el" href="class_j_b_wopr_mqtt_device.html" title="W.O.P.R. WiFi and MQTT device class.">JBWoprMqttDevice</a></code> - This adds MQTT support to the <code>JBWoprWifiDevice</code> class.</li>
<li><code>JBWoprHomeAssistantDevice</code> - This adds Home Assistant support to the <code><a class="el" href="class_j_b_wopr_mqtt_device.html" title="W.O.P.R. WiFi and MQTT device class.">JBWoprMqttDevice</a></code> class.</li>
</ul>
<h1><a class="anchor" id="autotoc_md3"></a>
Dependencies</h1>
<p>Depending on the class used the following libraries need to be installed. They can all be installed using the Library Manager.</p>
<h2><a class="anchor" id="autotoc_md4"></a>
JBWoprDevice</h2>
<ul>
<li><a href="https://github.com/jonnybergdahl/Arduino_JBLogger_Library">JBLogger</a></li>
<li><a href="https://github.com/adafruit/Adafruit-GFX-Library">Adafruit_GFX</a></li>
<li><a href="https://github.com/adafruit/Adafruit_LED_Backpack">Adafruit_LEDBackpack</a></li>
<li><a href="https://github.com/adafruit/Adafruit_NeoPixel">Adafruit_NeoPixel</a></li>
<li><a href="https://github.com/mathertel/OneButton">OneButton</a></li>
<li><a href="https://github.com/bblanchon/ArduinoJson">ArduinoJson</a></li>
</ul>
<h2><a class="anchor" id="autotoc_md5"></a>
JBWoprWifiDevice</h2>
<p>The above, plus:</p>
<ul>
<li><a href="https://github.com/tzapu/WiFiManager">WiFiManager</a></li>
</ul>
<h2><a class="anchor" id="autotoc_md6"></a>
JBWoprMqttDevice</h2>
<p>The above, plus:</p>
<ul>
<li><a href="https://github.com/tzapu/WiFiManager">WiFiManager</a></li>
</ul>
<h2><a class="anchor" id="autotoc_md7"></a>
Compiling the examples</h2>
<p>Due to the size of the library, you may need to change the partition size in the Arduino IDE.</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Board   </th><th class="markdownTableHeadNone">Minimum <code>Partition Scheme</code>    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">TinyPICO / ESP32   </td><td class="markdownTableBodyNone">Minimal SPIFFS (Large APPS with OTA)    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">TinyS2 / ESP32S2   </td><td class="markdownTableBodyNone">Minimal SPIFFS (1.9MB APP with OTA/190 KB SPIFFS)    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">TinyS3 / ESP32S3   </td><td class="markdownTableBodyNone">Default (3MB APP with OTA/1.5MB SPIFFS)   </td></tr>
</table>
<h2><a class="anchor" id="autotoc_md8"></a>
Quick start</h2>
<p>Open the example 'JBWopr_Firmware', and uncomment one of the following defines. This is a feature complete firmware that you can also use as a starting point for your own firmware.</p>
<ul>
<li><code>FIRMWARE_VARIANT_WIFI</code> - Use the WiFiManager and web configuration portal</li>
<li><code>FIRMWARE_VARIANT_MQTT</code> - Use the WiFiManager, web configuration portal and MQTT support</li>
<li><code>FIRMWARE_VARIANT_HA</code> - Use the WiFiManager, web configuration portal, MQTT and Home Assistant support</li>
</ul>
<h2><a class="anchor" id="autotoc_md9"></a>
Code documentation</h2>
<p>Full code documentation is available at <a href="https://jonnybergdahl.github.io/jbwopr/">https://jonnybergdahl.github.io/jbwopr/</a></p>
<h1><a class="anchor" id="autotoc_md10"></a>
JBWoprDevice</h1>
<p>Create an instance of the <code><a class="el" href="class_j_b_wopr_device.html" title="W.O.P.R. device base class.">JBWoprDevice</a></code> class. Do any configuration you need to do then and call <code>begin()</code> in your <code>setup()</code> function. Then call <code>loop()</code> in your <code>loop()</code> function.</p>
<p>See the example 'JBWopr_DeviceDemo' for more information on the basic <code><a class="el" href="class_j_b_wopr_device.html" title="W.O.P.R. device base class.">JBWoprDevice</a></code> usage.</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="jbwopr_8h.html">jbwopr.h</a>&gt;</span></div>
<div class="line"> </div>
<div class="line"><a class="code hl_class" href="class_j_b_wopr_device.html">JBWoprDevice</a> wopr;</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> setup() {</div>
<div class="line">    <span class="comment">// Configure the JBWoprDevice class</span></div>
<div class="line">    <a class="code hl_struct" href="struct_j_b_wopr_configuration.html">JBWoprConfiguration</a>* config = wopr.<a class="code hl_function" href="group___config_group.html#ga9a068ec9b0c53eb62196e70d0adebc62">getConfiguration</a>();</div>
<div class="line">    config-&gt;<a class="code hl_variable" href="struct_j_b_wopr_configuration.html#aab66168bf4827ff6ffab98fa1d8b5303">timeFormat</a> = <span class="stringliteral">&quot;%H %M %s&quot;</span>;</div>
<div class="line">    config-&gt;<a class="code hl_variable" href="struct_j_b_wopr_configuration.html#a44488ad26a831d7ffc2f03312ce9b0f9">dateFormat</a> = <span class="stringliteral">&quot;%Y-%m-%d&quot;</span>;</div>
<div class="line">    config-&gt;<a class="code hl_variable" href="struct_j_b_wopr_configuration.html#a807865a78dd31a8095d164f02f4e33b0">displayBrightness</a> = 50;</div>
<div class="line">    config-&gt;<a class="code hl_variable" href="struct_j_b_wopr_configuration.html#ad9c177a6785eedf64d0bdd455dd59d05">defconLedsBrightness</a> = 50;</div>
<div class="line">    </div>
<div class="line">    <span class="comment">// Initialize the JBWoprDevice class, passing in the board version </span></div>
<div class="line">    <span class="comment">// JBWoprBoardVariant::HAXORZ or JBWoprBoardVariant::ORIGINAL</span></div>
<div class="line">    wopr.<a class="code hl_function" href="class_j_b_wopr_device.html#ac6b4a89f4fd1946c80b66aa457d610d2">begin</a>(<a class="code hl_enumvalue" href="jbwopr_8h.html#adb11b2dbabd7d8f2f5b093930485e053a6c84364490e642df1c64370a90aec894">JBWoprBoardVariant::HAXORZ</a>);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> loop() {</div>
<div class="line">    wopr.<a class="code hl_function" href="class_j_b_wopr_device.html#a2c6ff33e1c2b648a66306e8fb3da49e5">loop</a>();</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Add your code here</span></div>
<div class="line">}</div>
<div class="ttc" id="aclass_j_b_wopr_device_html"><div class="ttname"><a href="class_j_b_wopr_device.html">JBWoprDevice</a></div><div class="ttdoc">W.O.P.R. device base class.</div><div class="ttdef"><b>Definition</b> jbwopr.h:85</div></div>
<div class="ttc" id="aclass_j_b_wopr_device_html_a2c6ff33e1c2b648a66306e8fb3da49e5"><div class="ttname"><a href="class_j_b_wopr_device.html#a2c6ff33e1c2b648a66306e8fb3da49e5">JBWoprDevice::loop</a></div><div class="ttdeci">virtual void loop()</div><div class="ttdoc">JBWoprDevice loop.</div><div class="ttdef"><b>Definition</b> jbwopr.cpp:129</div></div>
<div class="ttc" id="aclass_j_b_wopr_device_html_ac6b4a89f4fd1946c80b66aa457d610d2"><div class="ttname"><a href="class_j_b_wopr_device.html#ac6b4a89f4fd1946c80b66aa457d610d2">JBWoprDevice::begin</a></div><div class="ttdeci">virtual bool begin(JBWoprBoardVariant variant=JBWoprBoardVariant::ORIGINAL)</div><div class="ttdoc">Initialize JBWoprDevice.</div><div class="ttdef"><b>Definition</b> jbwopr.cpp:30</div></div>
<div class="ttc" id="agroup___config_group_html_ga9a068ec9b0c53eb62196e70d0adebc62"><div class="ttname"><a href="group___config_group.html#ga9a068ec9b0c53eb62196e70d0adebc62">JBWoprDevice::getConfiguration</a></div><div class="ttdeci">JBWoprConfiguration * getConfiguration()</div><div class="ttdoc">Get current JBWoprDevice configuration.</div><div class="ttdef"><b>Definition</b> jbwopr.cpp:169</div></div>
<div class="ttc" id="ajbwopr_8h_html"><div class="ttname"><a href="jbwopr_8h.html">jbwopr.h</a></div><div class="ttdoc">Main header file for the JBWopr library.</div></div>
<div class="ttc" id="ajbwopr_8h_html_adb11b2dbabd7d8f2f5b093930485e053a6c84364490e642df1c64370a90aec894"><div class="ttname"><a href="jbwopr_8h.html#adb11b2dbabd7d8f2f5b093930485e053a6c84364490e642df1c64370a90aec894">HAXORZ</a></div><div class="ttdeci">@ HAXORZ</div><div class="ttdoc">Haxorz W.O.P.R. board.</div><div class="ttdef"><b>Definition</b> jbwopr.h:30</div></div>
<div class="ttc" id="astruct_j_b_wopr_configuration_html"><div class="ttname"><a href="struct_j_b_wopr_configuration.html">JBWoprConfiguration</a></div><div class="ttdoc">JBWoprDevice configuration.</div><div class="ttdef"><b>Definition</b> jbwopr.h:54</div></div>
<div class="ttc" id="astruct_j_b_wopr_configuration_html_a44488ad26a831d7ffc2f03312ce9b0f9"><div class="ttname"><a href="struct_j_b_wopr_configuration.html#a44488ad26a831d7ffc2f03312ce9b0f9">JBWoprConfiguration::dateFormat</a></div><div class="ttdeci">std::string dateFormat</div><div class="ttdoc">Date format.</div><div class="ttdef"><b>Definition</b> jbwopr.h:56</div></div>
<div class="ttc" id="astruct_j_b_wopr_configuration_html_a807865a78dd31a8095d164f02f4e33b0"><div class="ttname"><a href="struct_j_b_wopr_configuration.html#a807865a78dd31a8095d164f02f4e33b0">JBWoprConfiguration::displayBrightness</a></div><div class="ttdeci">uint8_t displayBrightness</div><div class="ttdoc">Display brightness.</div><div class="ttdef"><b>Definition</b> jbwopr.h:57</div></div>
<div class="ttc" id="astruct_j_b_wopr_configuration_html_aab66168bf4827ff6ffab98fa1d8b5303"><div class="ttname"><a href="struct_j_b_wopr_configuration.html#aab66168bf4827ff6ffab98fa1d8b5303">JBWoprConfiguration::timeFormat</a></div><div class="ttdeci">std::string timeFormat</div><div class="ttdoc">Time format.</div><div class="ttdef"><b>Definition</b> jbwopr.h:55</div></div>
<div class="ttc" id="astruct_j_b_wopr_configuration_html_ad9c177a6785eedf64d0bdd455dd59d05"><div class="ttname"><a href="struct_j_b_wopr_configuration.html#ad9c177a6785eedf64d0bdd455dd59d05">JBWoprConfiguration::defconLedsBrightness</a></div><div class="ttdeci">uint32_t defconLedsBrightness</div><div class="ttdoc">DEFCON LEDs brightness.</div><div class="ttdef"><b>Definition</b> jbwopr.h:58</div></div>
</div><!-- fragment --><p>The devices on the board are exposed via simple to use methods of the <code><a class="el" href="class_j_b_wopr_device.html" title="W.O.P.R. device base class.">JBWoprDevice</a></code> class.</p>
<div class="fragment"><div class="line">...</div>
<div class="line"><span class="comment">// Display</span></div>
<div class="line">wopr.displaySetBrightness(50);</div>
<div class="line">wopr.displaySetText(<span class="stringliteral">&quot;Hello World&quot;</span>);</div>
<div class="line">wopr.displaySetScrollText(<span class="stringliteral">&quot;Hello scrolling world&quot;</span>);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// DEFCON</span></div>
<div class="line">wopr.defconSetBrightness(50);</div>
<div class="line">wopr.defconLedsSetDefconLebel(JBWoprDefconLevel::DEFCON1);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Buttons</span></div>
<div class="line">wopr.<a class="code hl_function" href="group___button_group.html#ga694baaaf32f91cfc021e9d79b0b69e6f">buttonFrontRightSetClickCallback</a>(ButtonFrontRightClick);</div>
<div class="line">...</div>
<div class="line"> </div>
<div class="line">void ButtonFrontRightClick() {</div>
<div class="line">  Serial.println(<span class="stringliteral">&quot;Front right button clicked&quot;</span>);</div>
<div class="line">}</div>
<div class="ttc" id="agroup___button_group_html_ga694baaaf32f91cfc021e9d79b0b69e6f"><div class="ttname"><a href="group___button_group.html#ga694baaaf32f91cfc021e9d79b0b69e6f">JBWoprDevice::buttonFrontRightSetClickCallback</a></div><div class="ttdeci">virtual void buttonFrontRightSetClickCallback(std::function&lt; void()&gt; func)</div><div class="ttdoc">Set front right button click callback.</div><div class="ttdef"><b>Definition</b> jbwopr.cpp:560</div></div>
</div><!-- fragment --><p>There is also support for running effects. There are some effects bundled with library, but you can also create your own effects by inheriting from the <code><a class="el" href="class_j_b_wopr_effect_base.html" title="Abstract effect base class.">JBWoprEffectBase</a></code> class.</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="jbwopr_8h.html">jbwopr.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;effects/jbwopreffets.h&gt;</span></div>
<div class="line">begin() {</div>
<div class="line">    ...</div>
<div class="line">    wopr.<a class="code hl_function" href="group___effects_group.html#gae9419460a7d1e606c334f1a2ec744725">effectsRegisterEffect</a>(<span class="keyword">new</span> <a class="code hl_class" href="class_j_b_wopr_missile_code_solve_effect.html">JBWoprMissileCodeSolveEffect</a>(&amp;wopr,</div>
<div class="line">                               <a class="code hl_enumvalue" href="jbwopreffects_8h.html#a659d91a1f51e2ed8aad808a75315cb40a9b940ce83f2d03aabdd31ab2fee20813">CodeSolveVariant::MOVIE</a>,</div>
<div class="line">                               1000,</div>
<div class="line">                               <span class="stringliteral">&quot;Movie solve&quot;</span>));</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">loop() {</div>
<div class="line">    wopr.startEffect(<span class="stringliteral">&quot;Movie solve&quot;</span>);</div>
<div class="line">}</div>
<div class="ttc" id="aclass_j_b_wopr_missile_code_solve_effect_html"><div class="ttname"><a href="class_j_b_wopr_missile_code_solve_effect.html">JBWoprMissileCodeSolveEffect</a></div><div class="ttdoc">Display effect for showing the WOPR movie code solve.</div><div class="ttdef"><b>Definition</b> jbwopreffects.h:421</div></div>
<div class="ttc" id="agroup___effects_group_html_gae9419460a7d1e606c334f1a2ec744725"><div class="ttname"><a href="group___effects_group.html#gae9419460a7d1e606c334f1a2ec744725">JBWoprDevice::effectsRegisterEffect</a></div><div class="ttdeci">void effectsRegisterEffect(JBWoprEffectBase *effect)</div><div class="ttdoc">Register effect.</div><div class="ttdef"><b>Definition</b> jbwopr.cpp:191</div></div>
<div class="ttc" id="ajbwopreffects_8h_html_a659d91a1f51e2ed8aad808a75315cb40a9b940ce83f2d03aabdd31ab2fee20813"><div class="ttname"><a href="jbwopreffects_8h.html#a659d91a1f51e2ed8aad808a75315cb40a9b940ce83f2d03aabdd31ab2fee20813">MOVIE</a></div><div class="ttdeci">@ MOVIE</div><div class="ttdoc">Movie code solve.</div><div class="ttdef"><b>Definition</b> jbwopreffects.h:36</div></div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md11"></a>
Advanced usage of onboard devices</h2>
<p>The class exposes the onboard devices as the following:</p>
<ul>
<li>The 12 character display are exposed as an array of <code>Adafruit_AlphaNum4</code>devices</li>
<li>The 5 DEFCON LED's are exposed as a <code>Adafruit_NeoPixel</code> device</li>
<li>The buttons are exposed as <code>OneButton</code> devices</li>
</ul>
<p>Check out the following examples for more information:</p>
<ul>
<li>JBWopr_AudioDemo</li>
<li>JBWopr_ButtonDemo</li>
<li>JBWopr_DefconDemo</li>
<li>JBWopr_DisplayDemo</li>
</ul>
<h1><a class="anchor" id="autotoc_md12"></a>
JBWoprWifiDevice</h1>
<p>The <code>JBWoprWifiDevice</code> class adds WiFiManager and web configuration portal support to the <code><a class="el" href="class_j_b_wopr_device.html" title="W.O.P.R. device base class.">JBWoprDevice</a></code> class. At first boot it starts up an AP called <code>wopr-&lt;mac_address&gt;</code>. Connect to this AP and it will access the configuration portal. If it isn't opening that automatically, open the url <code><a href="http://192.168.4.1">http://192.168.4.1</a></code> to access the portal.</p>
<p>Enter the details for your WiFi network and click save. The device will reboot and connect to your WiFi network.</p>
<p>If the <em>Use web portal</em> setting is enabled, you can access the configuration portal by browsing to the IP address of the device. You can find the IP address by looking at the serial output of the device.</p>
<p>The following settings are available in the web portal:</p>
<p><img src="images/wificonfig.png" alt="WiFiManager" title="WiFi configuration" class="inline"/></p>
<h1><a class="anchor" id="autotoc_md13"></a>
JBWoprMqttDevice</h1>
<p>The '<a class="el" href="class_j_b_wopr_mqtt_device.html" title="W.O.P.R. WiFi and MQTT device class.">JBWoprMqttDevice</a>' class adds MQTT support to the <code>JBWoprWifiDevice</code> class. It uses the PubSubClient library to connect to an MQTT broker. It will publish the device state to the <code>&lt;mqtt_prefix&gt;/&lt;device_id&gt;/state</code> topic and listen for commands on the <code>&lt;mqtt_prefix&gt;/&lt;device_id&gt;/command</code> topic.</p>
<p>The following settings are available in the web portal:</p>
<p><img src="images/mqttconfig.png" alt="MQTT" title="MQTT configuration" class="inline"/></p>
<h2><a class="anchor" id="autotoc_md14"></a>
MQTT Topics</h2>
<p>At startup, the device will publish an availability message to the <code>&lt;mqtt_prefix&gt;/&lt;device_id&gt;/availability</code> topic with the payload <code>online</code>. It will also set the last will topic to the same topic with the payload <code>offline</code>. You can use that to check if the device is online or not.</p>
<p>Current device state is posted to the <code>&lt;mqtt_prefix&gt;/&lt;device_id&gt;/&lt;entity&gt;/state</code> topic, it is posted when state is changed.</p>
<h3><a class="anchor" id="autotoc_md15"></a>
Device</h3>
<p>The device will listen to messages on the following topic to restart the device.</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Topic   </th><th class="markdownTableHeadNone">Example payload   </th><th class="markdownTableHeadNone">Comment    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">&lt;mqtt_prefix&gt;/&lt;device_id&gt;/device/state/set   </td><td class="markdownTableBodyNone"><code>restart</code>   </td><td class="markdownTableBodyNone"><code>restart</code>   </td></tr>
</table>
<h3><a class="anchor" id="autotoc_md16"></a>
Configuration</h3>
<p>The device will listen to messages on the following topic to change configuration.</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Topic   </th><th class="markdownTableHeadNone">Example payload   </th><th class="markdownTableHeadNone">Comment    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">&lt;mqtt_prefix&gt;/&lt;device_id&gt;/config/date_format/set   </td><td class="markdownTableBodyNone"><code>Y-m-d</code>   </td><td class="markdownTableBodyNone">Date format    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">&lt;mqtt_prefix&gt;/&lt;device_id&gt;/config/time_format/set   </td><td class="markdownTableBodyNone"><code>H M S</code>   </td><td class="markdownTableBodyNone">Time format    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">&lt;mqtt_prefix&gt;/&lt;device_id&gt;/config/defcon_brightness/set   </td><td class="markdownTableBodyNone">50   </td><td class="markdownTableBodyNone">DEFCON brightness    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">&lt;mqtt_prefix&gt;/&lt;device_id&gt;/config/display_brightness/set   </td><td class="markdownTableBodyNone">50   </td><td class="markdownTableBodyNone">Display brightness    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">&lt;mqtt_prefix&gt;/&lt;device_id&gt;/config/effects_timeout/set   </td><td class="markdownTableBodyNone">30   </td><td class="markdownTableBodyNone">Effects timeout    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">&lt;mqtt_prefix&gt;/&lt;device_id&gt;/config/use_web_portal/set   </td><td class="markdownTableBodyNone"><code>True</code>   </td><td class="markdownTableBodyNone">Use web portal   </td></tr>
</table>
<blockquote class="doxtable">
<p>&zwj;The other settings defines the MQTT configuration so can't be set over MQTT.</p>
<p></p>
</blockquote>
<p>#### Effects</p>
<p>The device will post a message to the following topics when an effect state is changed.</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Topic   </th><th class="markdownTableHeadNone">Example payload   </th><th class="markdownTableHeadNone">Comment    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">&lt;mqtt_prefix&gt;/&lt;device_id&gt;/effect/state   </td><td class="markdownTableBodyNone"><code>ON</code>   </td><td class="markdownTableBodyNone">Effect state, on/off    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">&lt;mqtt_prefix&gt;/&lt;device_id&gt;/effect/name   </td><td class="markdownTableBodyNone"><code>Rainbow</code>   </td><td class="markdownTableBodyNone">Effect name   </td></tr>
</table>
<p>The device will listen to messages on the following topics.</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Topic   </th><th class="markdownTableHeadNone">Example payload   </th><th class="markdownTableHeadNone">Comment    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">&lt;mqtt_prefix&gt;/&lt;device_id&gt;/effect/state/set   </td><td class="markdownTableBodyNone"><code>ON</code>   </td><td class="markdownTableBodyNone"><code>ON</code> / <code>OFF</code>    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">&lt;mqtt_prefix&gt;/&lt;device_id&gt;/effect/name/set   </td><td class="markdownTableBodyNone"><code>Rainbow</code>   </td><td class="markdownTableBodyNone">Registered name, will start effect as well   </td></tr>
</table>
<h3><a class="anchor" id="autotoc_md17"></a>
Display</h3>
<p>The device will post a message to the following topics when the display state is changed.</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Topic   </th><th class="markdownTableHeadNone">Example payload   </th><th class="markdownTableHeadNone">Comment    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">&lt;mqtt_prefix&gt;/&lt;device_id&gt;/display/state   </td><td class="markdownTableBodyNone"><code>ON</code>   </td><td class="markdownTableBodyNone">Current display state, on/off    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">&lt;mqtt_prefix&gt;/&lt;device_id&gt;/display/text   </td><td class="markdownTableBodyNone"><code>Hello World</code>   </td><td class="markdownTableBodyNone">Currently displayed text    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">&lt;mqtt_prefix&gt;/&lt;device_id&gt;/display/scrolltext   </td><td class="markdownTableBodyNone"><code>Hello scrolling world</code>   </td><td class="markdownTableBodyNone">Currently scrolling text    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">&lt;mqtt_prefix&gt;/&lt;device_id&gt;/display/brightness   </td><td class="markdownTableBodyNone"><code>50</code>   </td><td class="markdownTableBodyNone">Current display brightness, percent   </td></tr>
</table>
<p>The device will listen to command messages on the following topics.</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Topic   </th><th class="markdownTableHeadNone">Example payload   </th><th class="markdownTableHeadNone">Comment    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">&lt;mqtt_prefix&gt;/&lt;device_id&gt;/display/state/set   </td><td class="markdownTableBodyNone"><code>ON</code>   </td><td class="markdownTableBodyNone"><code>ON</code> or <code>OFF</code>    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">&lt;mqtt_prefix&gt;/&lt;device_id&gt;/display/text/set   </td><td class="markdownTableBodyNone"><code>Hello World</code>   </td><td class="markdownTableBodyNone">ASCII characters only    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">&lt;mqtt_prefix&gt;/&lt;device_id&gt;/display/scrolltext/set   </td><td class="markdownTableBodyNone"><code>Hello scrolling world</code>   </td><td class="markdownTableBodyNone">ASCII characters only    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">&lt;mqtt_prefix&gt;/&lt;device_id&gt;/display/brightness/set   </td><td class="markdownTableBodyNone"><code>50</code>   </td><td class="markdownTableBodyNone"><code>0</code> to <code>100</code>   </td></tr>
</table>
<h3><a class="anchor" id="autotoc_md18"></a>
DEFCON LED's</h3>
<p>The device will post a message to the following topics when the DEFCON LED's state is changed.</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Topic   </th><th class="markdownTableHeadNone">Example payload   </th><th class="markdownTableHeadNone">Comment    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">&lt;mqtt_prefix&gt;/&lt;device_id&gt;/defcon/state   </td><td class="markdownTableBodyNone"><code>ON</code>   </td><td class="markdownTableBodyNone">Current DEFCON state, on/off    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">&lt;mqtt_prefix&gt;/&lt;device_id&gt;/defcon/level   </td><td class="markdownTableBodyNone"><code>1</code>   </td><td class="markdownTableBodyNone">Current DEFCON level    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">&lt;mqtt_prefix&gt;/&lt;device_id&gt;/defcon/brightness   </td><td class="markdownTableBodyNone"><code>50</code>   </td><td class="markdownTableBodyNone">Current DEFCON brightness, percent    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">&lt;mqtt_prefix&gt;/&lt;device_id&gt;/defcon/color   </td><td class="markdownTableBodyNone"><code>255,0,0</code>   </td><td class="markdownTableBodyNone">Current color value   </td></tr>
</table>
<p>The device will listen to command messages on the following topics.</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Topic   </th><th class="markdownTableHeadNone">Example payload   </th><th class="markdownTableHeadNone">Comment    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">&lt;mqtt_prefix&gt;/&lt;device_id&gt;/defcon/state/set   </td><td class="markdownTableBodyNone"><code>ON</code>   </td><td class="markdownTableBodyNone"><code>ON</code> or <code>OFF</code>    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">&lt;mqtt_prefix&gt;/&lt;device_id&gt;/defcon/level/set   </td><td class="markdownTableBodyNone"><code>1</code>   </td><td class="markdownTableBodyNone">Values <code>0</code>,<code>1</code>,<code>2</code>,<code>3</code>,<code>4</code>,<code>5</code>    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">&lt;mqtt_prefix&gt;/&lt;device_id&gt;/display/brightness/set   </td><td class="markdownTableBodyNone"><code>50</code>   </td><td class="markdownTableBodyNone"><code>0</code> to <code>100</code>    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">&lt;mqtt_prefix&gt;/&lt;device_id&gt;/defcon/color/set   </td><td class="markdownTableBodyNone"><code>0,0,128</code>   </td><td class="markdownTableBodyNone">RGB byte values in format <code>R,G,B</code>   </td></tr>
</table>
<h3><a class="anchor" id="autotoc_md19"></a>
Buttons</h3>
<p>The device will post a message to the following topics when a button is clicked or double-clicked.</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Topic   </th><th class="markdownTableHeadNone">Example payload   </th><th class="markdownTableHeadNone">Comment    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">&lt;mqtt_prefix&gt;/&lt;device_id&gt;/button_front_left/event   </td><td class="markdownTableBodyNone"><code>click</code>   </td><td class="markdownTableBodyNone"><code>click</code> or <code>double_click</code>    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">&lt;mqtt_prefix&gt;/&lt;device_id&gt;/button_front_right/event   </td><td class="markdownTableBodyNone"><code>double_click</code>   </td><td class="markdownTableBodyNone"><code>click</code> or <code>double_click</code>    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">&lt;mqtt_prefix&gt;/&lt;device_id&gt;/button_back_top/event   </td><td class="markdownTableBodyNone"><code>click</code>   </td><td class="markdownTableBodyNone"><code>click</code> or <code>double_click</code>    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">&lt;mqtt_prefix&gt;/&lt;device_id&gt;/button_back_bottom/event   </td><td class="markdownTableBodyNone"><code>click</code>   </td><td class="markdownTableBodyNone"><code>click</code> or <code>double_click</code>   </td></tr>
</table>
<h1><a class="anchor" id="autotoc_md20"></a>
JBWoprHomeAssistantDevice</h1>
<p>The <code>JBWoprHomeAssistantDevice</code> class adds Home Assistant support to the <code><a class="el" href="class_j_b_wopr_mqtt_device.html" title="W.O.P.R. WiFi and MQTT device class.">JBWoprMqttDevice</a></code> class. It will publish discovery data to the Home Assistant MQTT discovery topic when connected to the MQTT server.</p>
<p>When a connection to the MQTT server is established, the device will publish a message to the <code>&lt;mqtt_prefix&gt;/&lt;homeassistant prefix&gt;/status</code> topic with the payload <code>online</code>, and also set the last will topic to the same topic with the payload <code>offline</code>. Home Assistant will use that to check if the device is online or not.</p>
<p>It will then proceed to publish discovery data to the <code>&lt;mqtt_prefix&gt;/&lt;homeassistant prefix&gt;/&lt;entity&gt;/config</code> topic, followed by publishing diagnostics and configuration state in the form of JSON messages. It will finally publish the individual entity states.</p>
<p>The following settings are available in the web portal:</p>
<p><img src="images/haconfig.png" alt="WiFiManager" title="Home Assistant configuration" class="inline"/></p>
<h2><a class="anchor" id="autotoc_md21"></a>
Home Assistant</h2>
<p>Once the device has published discovery data to Home Assistant, it will be available under the MQTT integration.</p>
<p>If web portal is enabled, the <em>Visit</em> section will be active.</p>
<p><img src="images/hadeviceinfo.png" alt="Home Assistant Device" title="Device info" class="inline"/></p>
<p>The following entities will be available under <em>Controls</em>.</p>
<p><img src="images/hacontrols.png" alt="Home Assistant Controls" title="Controls" class="inline"/></p>
<p>The following entities will be available under <em>Configuration</em>.</p>
<p><img src="images/haconfiguration.png" alt="Home Assistant Configuration" title="Configuration" class="inline"/></p>
<p>The following entities will be available under <em>Diagnostics</em>.</p>
<p><img src="images/hadiagnostics.png" alt="Home Assistant Diagnostics" title="Diagnostics" class="inline"/></p>
<h2><a class="anchor" id="autotoc_md22"></a>
MQTT Topics</h2>
<p><code>JBWoprHomeAssistantDevice</code> uses the same topics as the <code><a class="el" href="class_j_b_wopr_mqtt_device.html" title="W.O.P.R. WiFi and MQTT device class.">JBWoprMqttDevice</a></code> class, and adds the following topics.</p>
<h2><a class="anchor" id="autotoc_md23"></a>
Diagnostics</h2>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Topic   </th><th class="markdownTableHeadNone">Example payload   </th><th class="markdownTableHeadNone">Comment    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">&lt;mqtt_prefix&gt;/&lt;device_id&gt;/diagnostics/state   </td><td class="markdownTableBodyNone">JSON payload, See below   </td><td class="markdownTableBodyNone">Diagnostics   </td></tr>
</table>
<div class="fragment"><div class="line">{</div>
<div class="line">  &quot;ipAddress&quot;: &quot;172.30.2.110&quot;,</div>
<div class="line">  &quot;rssi&quot;: -52,</div>
<div class="line">  &quot;ram&quot;: 201728,</div>
<div class="line">  &quot;version&quot;: &quot;1.0.0&quot;</div>
<div class="line">}</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md24"></a>
Configuration</h2>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Topic   </th><th class="markdownTableHeadNone">Example payload   </th><th class="markdownTableHeadNone">Comment    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">&lt;mqtt_prefix&gt;/&lt;device_id&gt;/config/state   </td><td class="markdownTableBodyNone">JSON payload, See below   </td><td class="markdownTableBodyNone">Configuration   </td></tr>
</table>
<div class="fragment"><div class="line">{</div>
<div class="line">  &quot;timeFormat&quot;: &quot;%H %M %S&quot;,</div>
<div class="line">  &quot;dateFormat&quot;: &quot;%Y-%m-%d&quot;,</div>
<div class="line">  &quot;defconBrightness&quot;: 50,</div>
<div class="line">  &quot;displayBrightness&quot;: 50,</div>
<div class="line">  &quot;effectsTimeout&quot;: 30,</div>
<div class="line">  &quot;hostName&quot;: &quot;wopr-461da0d8&quot;,</div>
<div class="line">  &quot;useWebPortal&quot;: true,</div>
<div class="line">  &quot;useMqtt&quot;: true,</div>
<div class="line">  &quot;mqttServerName&quot;: &quot;172.30.2.64&quot;,</div>
<div class="line">  &quot;mqttServerPort&quot;: 1883,</div>
<div class="line">  &quot;mqttUserName&quot;: &quot;user&quot;,</div>
<div class="line">  &quot;mqttPassword&quot;: &quot;pass&quot;,</div>
<div class="line">  &quot;mqttPrefix&quot;: &quot;wopr&quot;,</div>
<div class="line">  &quot;useHomeAssistant&quot;: true,</div>
<div class="line">  &quot;discoveryPrefix&quot;: &quot;homeassistant&quot;</div>
<div class="line">}</div>
</div><!-- fragment --> </div></div><!-- PageDoc -->
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.8 </li>
  </ul>
</div>
</body>
</html>
